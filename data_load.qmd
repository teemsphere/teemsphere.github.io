# Loading Data with `ems_data()`

## Overview

The `ems_data()` function loads and prepares GTAP database files for use in CGE model runs. It handles the three core GTAP data files (dat, par, and set) and can optionally convert between GTAP v6.2 and v7.0 formats. This function is also used to input any time steps (for temporally dynamic models) as well as load set mappings for sets that are read into the model (i.e., not constructed from set operations).

## Input files
Compatible input files are currently limited to those produced by the Global Trade Analysis Project (GTAP)[GTAP](https://www.gtap.agecon.purdue.edu/). Although the most recent database releases are proprietary, GTAP has consistently open-accessed databases two versions out (GTAP 9 database as of the current GTAP 11 release). In order to access the freely available database, users will need to [register](https://www.gtap.agecon.purdue.edu/access_member/profile/profile_addnew.aspx) with GTAP and download the "FlexAgg" format. For GTAP 9 this is accessible under the "GDyn 9 Data Base for 2011" subheader in the "Satellite Data and Utilities" section [here](https://www.gtap.agecon.purdue.edu/databases/archives.asp). For paying GTAP members, the current [`teems`] version is capable of handling the "FlexAgg" format for GTAP Databases 10 and 11.

At minimum, the basedata "dat", parameter "par", and set "set" files are required inputs for the dat_input, par_input, and set_input arguments respectively. Note that the names of these inputs vary according the GTAP release.

## Set mappings
In addition to input files, set mappings for sets that read-in must be provided. Read-in sets consist of sets which in the model Tablo file contain a "read" qualifier. For example, the region set below requires a set mapping to be loaded:
```
Set
    REG # regions #
    read elements from file GTAPSETS header "REG";  
```
while the non-margin set below is constructed from sets previous declared (read-in in the case of the standard [GTAPv7.0](https://github.com/teemsphere/teems-models/blob/main/GTAPv7.0/GTAPv7.0.tab)) and therefore requires no mapping.
```
Set
    NMRG # non-margin commodities # = COMM - MARG;  
```


```r
data <- ems_data(
  dat_input = "path/to/gsddat.har",  # Basedata coefficients
  par_input = "path/to/gsdpar.har",  # Parameter coefficients
  set_input = "path/to/gsdset.har",  # Set elements
  ...
)
```

## Future expansions
Expand to non-GTAP sources of data.